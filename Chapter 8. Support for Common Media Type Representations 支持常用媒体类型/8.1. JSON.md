8.1. JSON
========================

Jersey JSON 支持之际,一组扩展模块,每个模块包含一个[功能](http://jax-rs-spec.java.net/nonav/$%7Bjaxrs.api.version%7D/apidocs/javax/ws/rs/core/Feature.html)的实现,需要注册到您的[配置](http://jax-rs-spec.java.net/nonav/$%7Bjaxrs.api.version%7D/apidocs/javax/ws/rs/core/Configurable.html)实例(客户机/服务器)。有多个框架提供支持 JSON 处理和/或 JSON-to-Java 绑定。下面列出的模块提供支持 JSON 表示通过整合个人 JSON 框架 Jersey。目前,Jersey 集成了以下模块提供 JSON 支持:

* [MOXy](https://jersey.java.net/documentation/latest/user-guide.html#json.moxy)-JSON 默认通过 MOXy来绑定，并且在 Jersey 2.0 以来的应用程序是支持 JSON 绑定首选方法 。当JSON MOXy 模块在 类路径,Jersey 将自动发现模块和无缝地支持 JSON 绑定支持通过 MOXy 在应用程序中。([见4.3节,“自定发现功能”](https://jersey.java.net/documentation/latest/user-guide.html#deployment.autodiscoverable))。
* [Java API为JSON处理(JSON-P)](https://jersey.java.net/documentation/latest/user-guide.html#json.json-p)
* [Jackson](https://jersey.java.net/documentation/latest/user-guide.html#json.jackson)
* [Jettison](https://jersey.java.net/documentation/latest/user-guide.html#json.jettison)

##8.1.1. Approaches to JSON Support 支持JSON方法

每个上述扩展模块使用一个或多个可用的三种基本方法在处理JSON表示:

* 基于 POJO 的 JSON 绑定
* 基于 JAXB 的 JSON 绑定
* 低级的JSON解析和处理支持

### 8.1.1.1. POJO support 基于 POJO 

POJO的支持是最简单的方法将 Java 对象转换为 JSON 和转回去。
媒体模块,支持这种方法是 [MOXy](https://jersey.java.net/documentation/latest/user-guide.html#json.moxy) 和 [Jackson](https://jersey.java.net/documentation/latest/user-guide.html#json.jackson)

##8.1.1.2. JAXB based JSON support 基于 JAXB

采取这种方法可以节省大量的时间,如果你想轻松地生成/使用 JSON 和 XML 数据格式。与 JAXB bean 你将能够使用相同的 Java 模型生成JSON和 XML 表示。与这样一个合作的另一个优点是简单模型和 API 在 Java SE 平台的可用性。 JAXB 使用注解的 pojo,这些可以处理简单的 Java bean。

基于 JAXB 方法的一个缺点可能是如果你需要使用一个非常具体的 JSON 格式。然后可能很难找到一个合适的方法来得到这样一个格式生产和消费。这是一个原因提供了许多配置选项,这样你就可以控制如何JAXB bean序列化和反序列化。额外的配置选项但是需要你更详细的了解您所使用的框架。

下面是一个非常简单的例子,来说明JAXB bean可能看起来像。

Example 8.1. Simple JAXB bean implementation
	
	@XmlRootElement
	public class MyJaxbBean {
	    public String name;
	    public int age;
	 
	    public MyJaxbBean() {} // JAXB needs this
	 
	    public MyJaxbBean(String name, int age) {
	        this.name = name;
	        this.age = age;
	    }
	}

使用上面的JAXB bean生成JSON数据格式资源方法,然后一样简单:

Example 8.2. JAXB bean used to generate JSON representation
	
	@GET
	@Produces("application/json")
	public MyJaxbBean getMyBean() {
	    return new MyJaxbBean("Agamemnon", 32);
	}

注意,JSON @Produces 注释中指定特定的mime类型,MyJaxbBean 的方法返回一个实例,JAXB 能够处理。生成的JSON在这种情况下会看起来像:

{"name":"Agamemnon", "age":"32"}

正确使用 JAXB 注解本身可以控制一定 JSON 格式输出。具体来说,直接通过使用 JAXB 注释很容易做到重命名和删除属性。例如,下面的例子描述了上述 MyJaxbBean 变化将导致 {"king":"Agamemnon"}  JSON输出。

Example 8.3. Tweaking JSON format using JAXB

	@XmlRootElement
	public class MyJaxbBean {
	 
	    @XmlElement(name="king")
	    public String name;
	 
	    @XmlTransient
	    public int age;
	 
	    // several lines removed
	}

媒体模块,支持这种方法是 [MOXy](https://jersey.java.net/documentation/latest/user-guide.html#json.moxy), [Jackson](https://jersey.java.net/documentation/latest/user-guide.html#json.jackson),[Jettison](https://jersey.java.net/documentation/latest/user-guide.html#json.jettison)

###8.1.1.3. Low-level based JSON support 低级的JSON解析和处理支持

JSON 处理 API 是一个新的标准 API 进行解析和处理 JSON 结构以类似的方式,SAX 和 StAX 解析器提供对 XML 。这个 API 是Java EE 7 和后来的一部分。另一个 JSON 解析/处理抛弃框架提供的 API。这两种 api 提供一个低级访问生产和消费 JSON 数据结构。采用这种低级的方法你会使用JsonObject(或JsonObject) 和/或 JsonArray (或分别 JsonArray )类在处理JSON数据表示。

这些低级 api 的最大优势是,你会得到完全控制和消费产生的 JSON 格式。你也能够生产和消费非常大的 JSON 结构使用流 JSON 解析器/生成器api。另一方面,处理您的数据模型对象可能会更复杂,相对于 POJO 或基于JAXB 绑定方法。差异是描述在以下代码片段。

基于JAXB 绑定方法

Example 8.4. JAXB bean creation

	MyJaxbBean myBean = new MyJaxbBean("Agamemnon", 32);

当你构建一个 JAXB bean 时，JSON 写成  {"name":"Agamemnon", "age":32}

现在构建一个等价的 JsonObject / JsonObject(生成的JSON的表达式),您需要几行代码。下面的例子说明了如何构造相同的 JSON 数据使用标准的Java EE 7 JSON处理API。

	JsonObject myObject = Json.createObjectBuilder()
	        .add("name", "Agamemnon")
	        .add("age", 32)
	        .build();

最后看下使用 Jettison 来做同样的事，

Example 8.6. Constructing a JSONObject (Jettison)


	JSONObject myObject = new JSONObject();
	try {
	    myObject.put("name", "Agamemnon");
	    myObject.put("age", 32);
	} catch (JSONException ex) {
	    LOGGER.log(Level.SEVERE, "Error ...", ex);
	}

媒体模块,支持低级 JSON 解析和生成方法是 [Java API for JSON Processing (JSON-P)](https://jersey.java.net/documentation/latest/user-guide.html#json.json-p)和[Jettison](https://jersey.java.net/documentation/latest/user-guide.html#json.jettison)。除非你有强烈的理由使用非标准抛[Jettison](https://jersey.java.net/documentation/latest/user-guide.html#json.jettison) API,我们推荐您使用新标准[Java API for JSON Processing (JSON-P)](https://jersey.java.net/documentation/latest/user-guide.html#json.json-p) API。


##8.1.2. MOXy 
###8.1.2.1. Dependency

需要添加 jersey-media-moxy 依赖库在你的  pom.xml 来使用 MOXy 

	<dependency>
	    <groupId>org.glassfish.jersey.media</groupId>
	    <artifactId>jersey-media-moxy</artifactId>
	    <version>2.13</version>
	</dependency>

不用 maven 的话，要确保所有需要的库在类路径下，建[jersey-media-moxy](https://jersey.java.net/project-info/2.13/jersey/project/jersey-media-moxy/dependencies.html)

###8.1.2.2. Configure and register 配置和注册

如上所述在[4.3节,“自定发现功能”](https://jersey.java.net/documentation/latest/user-guide.html#deployment.autodiscoverable)以及在本章早些时候,MOXy 模块是您不需要显式地注册它的特性(MoxyJsonFeature)在您的客户端/服务器[配置](http://jax-rs-spec.java.net/nonav/$%7Bjaxrs.api.version%7D/apidocs/javax/ws/rs/core/Configurable.html)的模块之一，这个特性是自动发现和注册时将 jersey-media-moxy 模块添加到您的类路径。

自动发现的 jersey-media-moxy 模块定义了几个属性,可用于控制自动登记MoxyJsonFeature(除了通用[CommonProperties.FEATURE_AUTO_DISCOVERY_DISABLE](https://jersey.java.net/apidocs/2.13/jersey/org/glassfish/jersey/CommonProperties.html#FEATURE_AUTO_DISCOVERY_DISABLE)一个客户机/服务器变量):
* [CommonProperties.MOXY_JSON_FEATURE_DISABLE](https://jersey.java.net/apidocs/2.13/jersey/org/glassfish/jersey/CommonProperties.html#MOXY_JSON_FEATURE_DISABLE)
* [ServerProperties.MOXY_JSON_FEATURE_DISABLE](https://jersey.java.net/apidocs/2.13/jersey/org/glassfish/jersey/server/ServerProperties.html#MOXY_JSON_FEATURE_DISABLE)
* [ClientProperties.MOXY_JSON_FEATURE_DISABLE](https://jersey.java.net/apidocs/2.13/jersey/org/glassfish/jersey/client/ClientProperties.html#MOXY_JSON_FEATURE_DISABLE)

**注意**
手动注册其他Jersey JSON提供者功能(除了[Java API for JSON Processing (JSON-P)](https://jersey.java.net/documentation/latest/user-guide.html#json.json-p)) 禁用MoxyJsonFeature的自动启用和配置。

